# Локальная Документация TradingBot

Этот документ является кратким справочником для разработки. Полная документация находится в `../TRADING_BOT_DEVELOPMENT_PLAN.md`

## Текущий Статус

**Sprint 1: ЗАВЕРШЕН** ✅ (19 октября 2025)

## Быстрый Старт

### Запуск приложения

1. Убедитесь, что arb1 запущен на `ws://127.0.0.1:8181`
2. Запустите TradingBot:
```bash
cd src/TradingBot.ConsoleHost
dotnet run
```

### Сборка проекта

```bash
dotnet build
```

## Структура Проекта

```
TradingBot/
├── src/
│   ├── TradingBot.Core/              # Основная логика
│   │   ├── Abstractions/             # Интерфейсы
│   │   ├── Domain/                   # DTO и модели
│   │   ├── Infrastructure/Json/      # JsonContext для Source Generation
│   │   └── Services/                 # Сервисы (WebSocket, Strategy)
│   └── TradingBot.ConsoleHost/       # Хост приложение
│       ├── Program.cs                # Точка входа
│       ├── Worker.cs                 # Background Service
│       └── appsettings.json          # Конфигурация
└── DEVELOPMENT_PLAN.md               # Этот файл
```

## Конфигурация

Файл: `src/TradingBot.ConsoleHost/appsettings.json`

```json
{
  "ConnectionStrings": {
    "WebSocket": "ws://127.0.0.1:8181"
  },
  "Mexc": {
    "ApiKey": "mx0vgl2GCBSEJV0C8Q",
    "ApiSecret": "256739ba45c04e3da03e4ec52c6521b3"
  },
  "TradingStrategy": {
    "SpreadThreshold": 0.5
  }
}
```

## Sprint 1: MVP - Базовый потребитель данных ✅ ЗАВЕРШЕН

**Цель:** Создать и протестировать базовый функционал "купи-продай" на основе данных из `SpreadAggregator`. Результатом спринта будет консольное приложение, которое подключается к WebSocket, получает и десериализует данные о спредах, и на основе простейшей логики выводит в консоль решения "BUY" или "SELL".

### Задачи Спринта 1:

1.  **Настройка структуры проекта:**
    *   Создать новое решение (`.sln`) с именем `TradingBot`.
    *   Создать основной проект — консольное приложение `TradingBot.ConsoleHost` на .NET 9.
    *   Создать библиотеку классов `TradingBot.Core` для основной логики (DTO, сервисы, интерфейсы).
    *   Настроить базовую конфигурацию (appsettings.json) для хранения URL WebSocket-сервера.

2.  **Реализация WebSocket-клиента:**
    *   **Библиотека:** Использовать `Websocket.Client` для обеспечения отказоустойчивости и автоматического переподключения. Это соответствует принципу Low-Code.
    *   **Сервис:** Создать сервис-обертку `WebSocketConsumerService`, который будет инкапсулировать логику подключения, подписки на сообщения и обработки отключений.
    *   **Конфигурация:** URL WebSocket-сервера (`ws://127.0.0.1:8181`) будет считываться из `appsettings.json`.

3.  **Высокопроизводительная десериализация:**
    *   **DTO:** Создать в `TradingBot.Core` объекты `SpreadDataPackage` и `SpreadDto` для представления входящих данных.
    *   **Парсинг:** Использовать `System.Text.Json` с **Source Generation** для максимальной производительности и устранения рефлексии при десериализации JSON-сообщений, поступающих из WebSocket. Это ключевой шаг для достижения high-performance.

4.  **Реализация простейшей торговой стратегии (MVP):**
    *   Создать сервис `TradingStrategyService`.
    *   Реализовать в нем простейшую логику: если `spreadPercentage` для какой-либо пары превышает заданный порог (например, `0.5%`), сервис должен сгенерировать решение "BUY" или "SELL".
    *   Решение (например, `Decision(Action, Symbol, Price)`) будет просто выводиться в лог.

5.  **Базовое логирование:**
    *   **Библиотека:** Интегрировать `Microsoft.Extensions.Logging` для логирования.
    *   **События:** Логировать ключевые события:
        *   `INFO`: Попытка подключения к WebSocket.
        *   `INFO`: Успешное подключение.
        *   `WARN`: Разрыв соединения, попытка переподключения.
        *   `DEBUG`: Получен новый пакет данных.
        *   `INFO`: Принято торговое решение (BUY/SELL).
        *   `ERROR`: Критические ошибки (например, сбой десериализации).

### Критерии приемки для Sprint 1:
- [ ] Приложение успешно запускается.
- [ ] Приложение подключается к WebSocket-серверу `SpreadAggregator`.
- [ ] В случае разрыва соединения приложение автоматически пытается переподключиться.
- [ ] Входящие JSON-сообщения корректно десериализуются в объекты `SpreadDto`.
- [ ] Приложение выводит в консоль торговые решения (BUY/SELL) на основе заданной логики.
- [ ] Все ключевые события логируются в консоль.