# Бэклог проекта: Торговый бот "Spread Capture"

Этот документ отслеживает все задачи, сгруппированные по спринтам, для разработки торгового бота на C# для биржи MEXC.

---

## Структура Проекта

```
/
├── src/
│   ├── Trader.ConsoleHost/         # Исполняемое приложение
│   ├── Trader.Core/                # Ядро стратегии и бизнес-логики
│   ├── Trader.ExchangeApi/         # Адаптер для работы с API биржи
│   ├── Trader.Scanner/             # Логика сканирования и выбора пар
│   └── Trader.Infrastructure/      # Логирование, конфигурация и т.д.
└── Trader.sln
```

---

## Спринт 0: Инициализация проекта и настройка окружения (ЗАВЕРШЕН)

**Цель:** Создать структуру решения, настроить базовые зависимости и конфигурацию.

- [x] Создать файл решения `Trader.sln`.
- [x] Создать проекты согласно архитектуре:
    - [x] `Trader.ConsoleHost`
    - [x] `Trader.Core`
    - [x] `Trader.ExchangeApi`
    - [x] `Trader.Scanner`
    - [x] `Trader.Infrastructure`
- [x] Добавить базовые NuGet-пакеты:
    - [x] `Microsoft.Extensions.Hosting` в `Trader.ConsoleHost` для управления жизненным циклом.
    - [x] `Serilog`, `Serilog.Sinks.Console`, `Serilog.Sinks.File`, `Serilog.Extensions.Hosting` для логирования.
- [x] Создать и настроить `appsettings.json` в `Trader.ConsoleHost` с базовыми параметрами (API ключи, пустые секции для будущих настроек).
- [x] Настроить базовую конфигурацию логирования в `Trader.Infrastructure`.

---

## Спринт 1: Интеграция с API биржи (ЗАВЕРШЕН)

**Цель:** Реализовать слой-адаптер для взаимодействия с библиотекой `Mexc.Net`.

- [x] В `Trader.ExchangeApi` создать интерфейсы для REST и WebSocket клиентов (например, `IMexcRestApiClient`, `IMexcSocketApiClient`).
- [x] Реализовать методы для получения данных, необходимых для сканера (REST API):
    - [x] Получение списка всех торговых пар (`GetSymbolsAsync`).
    - [x] Получение тикеров за 24 часа для фильтрации по объему (`GetTickersAsync`).
    - [x] Получение стакана ордеров для расчета спреда (`GetOrderBookAsync`).
    - [x] Получение исторических данных (Klines/OHLCV) для анализа тренда (`GetKlinesAsync`).
- [x] Реализовать базовые методы для подписки на WebSocket-потоки (без обработки данных):
    - [x] Подписка на обновления стакана (`SubscribeToOrderBookUpdatesAsync`).
    - [x] Подписка на пользовательские данные (ордера, баланс) (`SubscribeToUserDataUpdatesAsync`).

---

## Спринт 2: Реализация сканера торговых пар (ЗАВЕРШЕН)

**Цель:** Создать модуль, который находит наиболее подходящую торговую пару согласно заданным критериям.

- [x] В `Trader.Scanner` создать сервис `MarketScannerService`.
- [x] Реализовать алгоритм сканирования:
    1.  [x] Получить все пары через `Trader.ExchangeApi`.
    2.  [x] Отфильтровать по суточному объему (> 1,500,000 USDT).
    3.  [x] Отфильтровать по объему за последние 15 минут (> 10,000 USDT), используя данные Klines.
    4.  [x] Отфильтровать по спреду (>= 0.35%).
    5.  [x] Реализовать логику определения бокового движения (флэта) на основе анализа Klines (1m, 5m, 15m).
    6.  [x] Отсортировать кандидатов по убыванию спреда.
- [x] Интегрировать сканер в `Trader.ConsoleHost` для первоначального выбора инструмента.

---

## Спринт 3: Разработка ядра торговой стратегии (В ПРОЦЕССЕ)

**Цель:** Реализовать основную логику "Spread Capture".

- [x] В `Trader.Core` создать `TradingStrategyService`.
- [x] Реализовать подписку на WebSocket-потоки для выбранной сканером пары.
- [x] Настроить парсинг данных из WebSocket с использованием `System.Text.Json` (Source Generation) для минимизации аллокаций.
- [-] Реализовать логику управления ордерами:
    - [ ] Размещение начальных ордеров (Bid и Ask).
    - [ ] Динамическая модификация ордеров при изменении лучших цен в стакане.
    - [ ] Обработка исполнения ордеров (fill):
        - [ ] При исполнении Bid-ордера, модифицировать/выставить соответствующий Ask-ордер.
        - [ ] При исполнении Ask-ордера, модифицировать/выставить соответствующий Bid-ордер.

---

## Спринт 4: Внедрение управления рисками

**Цель:** Добавить в ядро механизмы безопасности и контроля рисков.

- [ ] Реализовать логику Stop-Loss: при падении цены после покупки, закрывать позицию рыночным ордером.
- [ ] Реализовать управление инвентарем: приостанавливать новые покупки, если актив не удается продать в течение заданного времени.
- [ ] Реализовать "Аварийный выключатель" (Circuit Breaker): приостановка торгов при аномальной волатильности (схлопывание или резкое расширение спреда).
- [ ] Реализовать надежную обработку ошибок API с логикой повторных запросов (exponential backoff).

---

## Спринт 5: Финальная сборка и запуск

**Цель:** Интегрировать все модули в единое работающее приложение.

- [ ] В `Trader.ConsoleHost` настроить Dependency Injection для всех сервисов.
- [ ] Написать главный цикл приложения: `Запуск -> Сканирование -> Запуск ядра торговли`.
- [ ] Реализовать graceful shutdown (корректное завершение работы с отменой всех ордеров по Ctrl+C).
- [ ] Провести полное тестирование на тестовом счете с начальным капиталом 10 USDT.
- [ ] Финализировать конфигурацию в `appsettings.json` и проверить полноту логирования.